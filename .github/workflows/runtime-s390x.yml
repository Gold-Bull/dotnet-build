name: .NET Runtime (s390x)

on:
  workflow_dispatch:

  push:
    branches:
      - 'releases/**'
    tags:
      - v*
    paths-ignore:
      - '.gitignore'
      - 'LICENSE'
      - 'README.md'

jobs:
  build-and-publish:
    uses: ./.github/workflows/build-and-publish.yml
    permissions:
      actions: read
      contents: read
      deployments: read
      packages: write
    secrets: inherit
    with:
      repo-url: dotnet/runtime
      checkout-tag: v6.0.3
      runtime-arch: s390x
      runtime-configuration: Release
      build-commands: |
        git apply ../self/patches/001_init-complier_lld.patch
        
        export ROOTFS_DIR=/crossfs/${RUNTIME_ARCH}
        chmod +x ./build.sh
        ./build.sh --subset mono+libs+host+packs --cross --os ${RUNTIME_OS} --arch ${RUNTIME_ARCH} --configuration ${RUNTIME_CONFIGURATION}
